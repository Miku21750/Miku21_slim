{% block modal %}
{% include "modal_viewMore.html" %}
{% block viewMore %}
  
{% endblock viewMore %}
{% include "modal_edit.html" %}
{% block edit %}
  
{% endblock edit %}
{% include "modal_insert.html" %}
{% block insert %}
  
{% endblock insert %}
{% include "modal_insert_js.html" %}
{% block insert_js %}
  
{% endblock %}

<script>
  // popover setup
  
  const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
  const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))

  // setup autofocus
  const editModal = document.getElementById('edit')
  const myInput = document.getElementById('edit_fullname')

  editModal.addEventListener('shown.bs.modal', () => {
    myInput.focus()
})
  
  // Setup modal viewMore
  const viewMore = document.getElementById('viewMore')

  // Setup modal edit
  const edit = document.getElementById('edit')
  const editConfirm = document.getElementById('editConfirm')

  // add listener
  viewMore.addEventListener('show.bs.modal', event => {
    // Button that triggered the modal
    const button = event.relatedTarget
    const id = button.getAttribute('data-bs-whatever')
    // console.log(id)
    $(document).ready(function (e) {
      // e.preventDefault();
      
      $.ajax({
        type: "GET",
        url: '/' + id + '/select',
        success: function (response) {
          if (response) {
            // console.log(response)
            {% include "modal_viewMore_js.html" %}
            {% block viewMore_js %}
              
            {% endblock %}
            // Edit
            {% include "modal_edit_js.html" %}
            {% block edit_js %}
              
            {% endblock %}
            $('#editForm').submit(function (e) { 
              e.preventDefault();
              console.log(e);
              $.ajax({
                type: "POST",
                url: "/edit",
                data: {
                  id: $('#id_CUST').val(),
                  cust_id: $('#edit_id').val(),
                  cust_fullname: $('#edit_fullname').val(),
                  cust_workingArea: $('#edit_workingArea').val(),
                  cust_country: $('#edit_country').val(),
                  grade: $('#edit_grade').val(),
                  openingAMT: $('#openingAMT').val(),
                  receiveAMT: $('#receiveAMT').val(),
                  paymentAMT: $('#paymentAMT').val(),
                  outstandingAMT: $('#outstandingAMT').val(),
                  cust_phone: $('#edit_phone').val(),
                  cust_agent: $('#edit_agent').val(),
                },
                success: function (response) {
                  console.log(response)
                  Swal.fire({
                    icon: 'success',
                    title: 'Data berhasil diedit',
                    showConfirmButton: false,
                    timer: 1500
                  })
                  .then(function () {
                    window.location.replace('/');
                  })
                }
              });
            });
          } else {
            swalWithBootstrapButtons.fire(
              'Error!',
              'SQL has an error',
              'error'
            )
          }
        }
      });
    })
  })
  
</script>
{% endblock modal %}